<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}FitMacro Planner{% endblock %}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
    />
    <style>
      /* Choices.js: визуально ближе к flatpickr/Bootstrap (скругления и высота) */
      .choices__inner {
        border-radius: 0.5rem !important;
        min-height: calc(1.5em + 0.75rem + 2px);
        padding: 0.375rem 0.75rem;
        border-color: #dee2e6;
        background-color: #fff;
      }
      .choices[data-type*="select-one"] .choices__inner {
        padding-bottom: 0.375rem;
      }
      .choices__list--dropdown {
        border-radius: 0.75rem;
        border-color: #dee2e6;
        overflow: hidden;
      }
      .choices__list--dropdown .choices__item--selectable.is-highlighted {
        background: rgba(13, 110, 253, 0.12);
      }
    </style>
  </head>
  <body class="bg-body-tertiary">
    <nav class="navbar navbar-expand-lg bg-white border-bottom">
      <div class="container">
        {% load tr %}
        <a class="navbar-brand fw-semibold" href="/">{% tr ru="КБЖУ Трекер" en="NutriTracker" %}</a>
        <div class="ms-auto d-flex gap-2 align-items-center">
          <form action="{% url 'set_language' %}" method="post" class="d-inline">
            {% csrf_token %}
            <input name="next" type="hidden" value="{{ request.path }}" />
            {% with lang=request.session.django_language|default:'ru' %}
            <select name="language" onchange="this.form.submit()" class="form-select form-select-sm custom-select" style="width: auto;">
              <option value="ru" {% if lang == 'ru' %}selected{% endif %}>Русский</option>
              <option value="en" {% if lang == 'en' %}selected{% endif %}>English</option>
            </select>
            {% endwith %}
          </form>
          {% if user.is_authenticated %}
            <span class="text-secondary small">{{ user.username }}</span>
            <form method="post" action="{% url 'logout' %}" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-secondary btn-sm">{% tr ru="Выйти" en="Logout" %}</button>
            </form>
          {% else %}
            <a class="btn btn-outline-secondary btn-sm" href="{% url 'nutrition:register' %}">{% tr ru="Регистрация" en="Sign up" %}</a>
            <a class="btn btn-outline-primary btn-sm" href="{% url 'login' %}">{% tr ru="Войти" en="Sign in" %}</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <main class="container py-4">
      {% if messages %}
        <div class="mb-3">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} mb-2" role="alert">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
      {% block content %}{% endblock %}
    </main>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script>
      // Инициализация кастомного календаря для всех полей с классом .custom-date
      document.addEventListener('DOMContentLoaded', function() {
        flatpickr('.custom-date', {
          dateFormat: 'Y-m-d',
          locale: 'ru',
          allowInput: true,
        });
        
        // Инициализация кастомных select для всех полей с классом .custom-select
        const selects = document.querySelectorAll('.custom-select');
        selects.forEach(function(select) {
          new Choices(select, {
            searchEnabled: false,
            itemSelectText: '',
            shouldSort: false,
          });
        });
      });
    </script>
  </body>
</html>


