{% extends "base.html" %}
{% load tr %}

{% block title %}{% tr ru="Дашборд" en="Dashboard" %} — FitMacro Planner{% endblock %}

{% block content %}
  <div class="flex flex-wrap items-end justify-between gap-3 mb-4">
    <div>
      <h1 class="text-3xl font-semibold">{% tr ru="Дашборд" en="Dashboard" %}</h1>
      <div class="text-sm opacity-70">{% tr ru="Сегодня" en="Today" %}: {{ today|date:"Y-m-d" }}</div>
    </div>
    <div class="flex flex-wrap gap-2">
      <a class="btn btn-outline btn-sm" href="{% url 'nutrition:food_search' %}">{% tr ru="Импорт продуктов" en="Import foods" %}</a>
      <a class="btn btn-primary btn-sm" href="{% url 'nutrition:add_meal_item' %}">{% tr ru="Добавить еду" en="Add food" %}</a>
      <a class="btn btn-outline btn-sm" href="{% url 'nutrition:add_weight' %}">{% tr ru="Добавить вес" en="Add weight" %}</a>
      <a class="btn btn-outline btn-sm" href="{% url 'nutrition:set_goal' %}">{% tr ru="Цель" en="Goal" %}</a>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <div class="card bg-base-100 shadow-sm border border-base-300">
      <div class="card-body gap-3">
        <div>
          <div class="font-semibold mb-1">{% tr ru="Активная цель" en="Active goal" %}</div>
          {% if goal %}
            <div class="text-4xl font-bold leading-none">{{ goal.daily_kcal_target }}</div>
            <div class="opacity-70">{% tr ru="ккал в день" en="kcal/day" %}</div>
            {% if goal.target_weight_kg %}
              <div class="mt-2 text-sm opacity-70">{% tr ru="Цель по весу" en="Target weight" %}: {{ goal.target_weight_kg }} {% tr ru="кг" en="kg" %}</div>
            {% endif %}
          {% else %}
            <div class="opacity-70">{% tr ru="Пока не задана. Нажми «Цель»." en="Not set yet. Click “Goal”." %}</div>
          {% endif %}
        </div>

        <div class="divider my-1"></div>

        <div>
          <div class="font-semibold mb-2">{% tr ru="Сегодня" en="Today" %}</div>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between"><span class="opacity-70">{% tr ru="Калории" en="Calories" %}:</span><span class="font-semibold">{{ today_kcal }} / {% if goal %}{{ goal.daily_kcal_target }}{% else %}—{% endif %}</span></div>
            {% if progress.kcal is not None %}
              <div class="progress" role="progressbar" aria-label="{% tr ru='Прогресс калорий' en='Calories progress' %}" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ progress.kcal }}">
                <div class="progress__bar" style="width: {{ progress.kcal }}%"></div>
              </div>
            {% endif %}
            <div class="flex justify-between"><span class="opacity-70">{% tr ru="Белки" en="Protein" %}:</span><span class="font-semibold">{{ today_protein }}г{% if goal and goal.daily_protein_target %} / {{ goal.daily_protein_target }}г{% endif %}</span></div>
            {% if progress.protein is not None %}
              <div class="progress" role="progressbar" aria-label="{% tr ru='Прогресс белков' en='Protein progress' %}" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ progress.protein }}">
                <div class="progress__bar" style="width: {{ progress.protein }}%"></div>
              </div>
            {% endif %}
            <div class="flex justify-between"><span class="opacity-70">{% tr ru="Жиры" en="Fat" %}:</span><span class="font-semibold">{{ today_fat }}г{% if goal and goal.daily_fat_target %} / {{ goal.daily_fat_target }}г{% endif %}</span></div>
            {% if progress.fat is not None %}
              <div class="progress" role="progressbar" aria-label="{% tr ru='Прогресс жиров' en='Fat progress' %}" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ progress.fat }}">
                <div class="progress__bar" style="width: {{ progress.fat }}%"></div>
              </div>
            {% endif %}
            <div class="flex justify-between"><span class="opacity-70">{% tr ru="Углеводы" en="Carbs" %}:</span><span class="font-semibold">{{ today_carb }}г{% if goal and goal.daily_carb_target %} / {{ goal.daily_carb_target }}г{% endif %}</span></div>
            {% if progress.carb is not None %}
              <div class="progress" role="progressbar" aria-label="{% tr ru='Прогресс углеводов' en='Carbs progress' %}" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ progress.carb }}">
                <div class="progress__bar" style="width: {{ progress.carb }}%"></div>
              </div>
            {% endif %}
          </div>
        </div>

        <div class="divider my-1"></div>

        <div>
          <div class="font-semibold mb-1">{% tr ru="Последний вес" en="Latest weight" %}</div>
          {% if latest_weight %}
            <div class="text-2xl font-bold">{{ latest_weight.weight_kg }} {% tr ru="кг" en="kg" %}</div>
            <div class="text-sm opacity-70">{{ latest_weight.date|date:"Y-m-d" }}</div>
          {% else %}
            <div class="opacity-70">{% tr ru="Нет данных. Нажми «Добавить вес»." en="No data. Click “Add weight”." %}</div>
          {% endif %}
        </div>

        {% if weight_forecast %}
          <div class="divider my-1"></div>
          <div>
            <div class="font-semibold mb-1">{% tr ru="Прогноз веса" en="Weight forecast" %}</div>
            <div class="text-xl font-bold">{{ weight_forecast.predicted_weight }} {% tr ru="кг" en="kg" %}</div>
            <div class="text-sm opacity-70">
              {% if weight_forecast.weight_change > 0 %}
                +{{ weight_forecast.weight_change }} {% tr ru="кг" en="kg" %}
              {% else %}
                {{ weight_forecast.weight_change }} {% tr ru="кг" en="kg" %}
              {% endif %}
              ({% tr ru="дефицит" en="deficit" %}: {{ weight_forecast.deficit_kcal }} {% tr ru="ккал" en="kcal" %})
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <div class="lg:col-span-2 space-y-4">
      <div class="card bg-base-100 shadow-sm border border-base-300">
        <div class="card-body">
          <div class="font-semibold mb-2">{% tr ru="Калории за последние 14 дней" en="Calories (last 14 days)" %}</div>
          <div class="w-full overflow-x-auto">
            {{ calories_chart_html|safe }}
          </div>
        </div>
      </div>
      {% if weight_chart_html %}
        <div class="card bg-base-100 shadow-sm border border-base-300">
          <div class="card-body">
            <div class="font-semibold mb-2">{% tr ru="Динамика веса" en="Weight trend" %}</div>
            <div class="w-full overflow-x-auto">
              {{ weight_chart_html|safe }}
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}


