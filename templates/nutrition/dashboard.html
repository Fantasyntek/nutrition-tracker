{% extends "base.html" %}

{% block title %}Дашборд — FitMacro Planner{% endblock %}

{% block content %}
  <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h3 mb-1">Дашборд</h1>
      <div class="text-secondary small">Сегодня: {{ today }}</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{% url 'nutrition:food_search' %}">Импорт продуктов</a>
      <a class="btn btn-primary" href="{% url 'nutrition:add_meal_item' %}">Добавить еду</a>
      <a class="btn btn-outline-primary" href="{% url 'nutrition:add_weight' %}">Добавить вес</a>
      <a class="btn btn-outline-secondary" href="{% url 'nutrition:set_goal' %}">Цель</a>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12 col-lg-4">
      <div class="bg-white border rounded-3 p-3 h-100">
        <div class="fw-semibold mb-2">Активная цель</div>
        {% if goal %}
          <div class="display-6 lh-1">{{ goal.daily_kcal_target }}</div>
          <div class="text-secondary">ккал в день</div>
          {% if goal.target_weight_kg %}
            <div class="mt-3 text-secondary small">Цель по весу: {{ goal.target_weight_kg }} кг</div>
          {% endif %}
        {% else %}
          <div class="text-secondary">Пока не задана. Нажми «Цель».</div>
        {% endif %}

        <hr />
        <div class="fw-semibold mb-2">Сегодня</div>
        <div class="mb-2">
          <div class="d-flex justify-content-between">
            <span class="text-secondary">Калории:</span>
            <span class="fw-semibold">{{ today_kcal }} / {% if goal %}{{ goal.daily_kcal_target }}{% else %}—{% endif %}</span>
          </div>
          {% if goal %}
            {% if goal.daily_protein_target %}
              <div class="d-flex justify-content-between">
                <span class="text-secondary">Белки:</span>
                <span class="fw-semibold">{{ today_protein }}г / {{ goal.daily_protein_target }}г</span>
              </div>
            {% endif %}
            {% if goal.daily_fat_target %}
              <div class="d-flex justify-content-between">
                <span class="text-secondary">Жиры:</span>
                <span class="fw-semibold">{{ today_fat }}г / {{ goal.daily_fat_target }}г</span>
              </div>
            {% endif %}
            {% if goal.daily_carb_target %}
              <div class="d-flex justify-content-between">
                <span class="text-secondary">Углеводы:</span>
                <span class="fw-semibold">{{ today_carb }}г / {{ goal.daily_carb_target }}г</span>
              </div>
            {% endif %}
          {% else %}
            <div class="text-secondary small">Белки: {{ today_protein }}г</div>
            <div class="text-secondary small">Жиры: {{ today_fat }}г</div>
            <div class="text-secondary small">Углеводы: {{ today_carb }}г</div>
          {% endif %}
        </div>

        <hr />
        <div class="fw-semibold mb-2">Последний вес</div>
        {% if latest_weight %}
          <div class="h4 mb-0">{{ latest_weight.weight_kg }} кг</div>
          <div class="text-secondary small">{{ latest_weight.date }}</div>
        {% else %}
          <div class="text-secondary">Нет данных. Нажми «Добавить вес».</div>
        {% endif %}

        {% if weight_forecast %}
          <hr />
          <div class="fw-semibold mb-2">Прогноз веса</div>
          <div class="h5 mb-1">{{ weight_forecast.predicted_weight }} кг</div>
          <div class="text-secondary small">
            {% if weight_forecast.weight_change > 0 %}
              +{{ weight_forecast.weight_change }} кг
            {% else %}
              {{ weight_forecast.weight_change }} кг
            {% endif %}
            (дефицит: {{ weight_forecast.deficit_kcal }} ккал)
          </div>
        {% endif %}
      </div>
    </div>

    <div class="col-12 col-lg-8">
      <div class="row g-4">
        <div class="col-12">
          <div class="bg-white border rounded-3 p-3">
            <div class="fw-semibold mb-2">Калории за последние 14 дней</div>
            <div>
              {{ calories_chart_html|safe }}
            </div>
          </div>
        </div>
        {% if weight_chart_html %}
          <div class="col-12">
            <div class="bg-white border rounded-3 p-3">
              <div class="fw-semibold mb-2">Динамика веса</div>
              <div>
                {{ weight_chart_html|safe }}
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}


